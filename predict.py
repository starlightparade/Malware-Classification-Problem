import numpy as np
import pandas as pd
import keras
#from google.colab import files
import xgboost as xgb
from train import create_cnn_model, create_xgb_model
from train import Dataset

dataset = Dataset()
x_test = dataset.x_test
keras_model = create_cnn_model()
xgb_model = create_xgb_model()

keras_predict = keras_model.predict(x_test, batch_size=None, verbose=0, steps=None)
print("keras predict: ",keras_predict.shape)

dtest = xgb.DMatrix(x_test)
xgb_predict = xgb_model.predict(dtest)
print("xgb predict: ",xgb_predict.shape)
xgb_predict = xgb_predict.reshape(-1,1)

predictions = keras_predict*0.5 + xgb_predict*0.5
print(predictions.shape)

ids = np.arange(len(predictions))
print(ids.shape)
ids = ids.reshape(-1,1)
data_print = np.concatenate((ids, predictions),axis = 1)
df = pd.DataFrame(data_print, columns=['sample_id', 'malware'])
df.to_csv('result.csv', index=False)
#files.download('result.csv')